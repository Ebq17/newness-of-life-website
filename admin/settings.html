<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Einstellungen - Admin Dashboard</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="css/base.css">
  <link rel="stylesheet" href="css/settings.css">
</head>
<body>
  <aside class="sidebar">
    <div class="sidebar-header">
      <h1>Newness of Life</h1>
      <span>Admin Dashboard</span>
    </div>
    <nav class="sidebar-nav">
      <div class="nav-section">
        <div class="nav-section-title">Übersicht</div>
        <a href="dashboard.html" class="nav-item">
          <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zm10 0a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zm10 0a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z"></path></svg>
          Dashboard
        </a>
      </div>
      <div class="nav-section">
        <div class="nav-section-title">Inhalte</div>
        <a href="events.html" class="nav-item">
          <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg>
          Events
        </a>
        <a href="pages.html" class="nav-item">
          <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path></svg>
          Seiten
        </a>
        <a href="media.html" class="nav-item">
          <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg>
          Medien
        </a>
      </div>
      <div class="nav-section">
        <div class="nav-section-title">Einstellungen</div>
        <a href="settings.html" class="nav-item active">
          <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path></svg>
          Einstellungen
        </a>
      </div>
    </nav>
  </aside>

  <main class="main">
    <header class="header">
      <h2 class="header-title">Einstellungen</h2>
      <button class="btn btn-success" onclick="saveSettings()">
        <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>
        Speichern
      </button>
    </header>

    <div class="content">
      <!-- Allgemein -->
      <div class="card">
        <div class="card-header">
          <h3 class="card-title">Allgemeine Einstellungen</h3>
          <p class="card-desc">Grundlegende Informationen über die Website</p>
        </div>
        <div class="card-body">
          <div class="form-group">
            <label class="form-label">Website-Titel</label>
            <input type="text" class="form-input" id="siteTitle" value="Newness of Life">
          </div>
          <div class="form-group">
            <label class="form-label">Beschreibung</label>
            <textarea class="form-textarea" id="siteDescription"></textarea>
            <p class="form-hint">Wird in Suchmaschinen angezeigt</p>
          </div>
        </div>
      </div>

      <!-- Kontakt -->
      <div class="card">
        <div class="card-header">
          <h3 class="card-title">Kontaktdaten</h3>
          <p class="card-desc">Adresse und Kontaktinformationen</p>
        </div>
        <div class="card-body">
          <div class="form-group">
            <label class="form-label">E-Mail</label>
            <input type="email" class="form-input" id="contactEmail" placeholder="newnessoflife@clgi.org">
          </div>
          <div class="form-group">
            <label class="form-label">Telefon (optional)</label>
            <input type="tel" class="form-input" id="contactPhone" placeholder="+49 ...">
            <p class="form-hint">Wird nur angezeigt, wenn gesetzt.</p>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label class="form-label">Straße / Adresse</label>
              <input type="text" class="form-input" id="contactAddress" placeholder="Hebbelstr. 56-60">
            </div>
            <div class="form-group">
              <label class="form-label">PLZ &amp; Stadt</label>
              <input type="text" class="form-input" id="contactCity" placeholder="55127 Mainz">
            </div>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label class="form-label">Land</label>
              <input type="text" class="form-input" id="contactCountry" placeholder="Deutschland">
            </div>
            <div class="form-group">
              <label class="form-label">Google Maps URL</label>
              <input type="url" class="form-input" id="contactMapsUrl" placeholder="https://www.google.com/maps?q=...">
            </div>
          </div>
        </div>
      </div>

      <!-- Social Media -->
      <div class="card">
        <div class="card-header">
          <h3 class="card-title">Social Media</h3>
          <p class="card-desc">Links zu euren Profilen (werden nur angezeigt, wenn gesetzt)</p>
        </div>
        <div class="card-body">
          <div class="form-row">
            <div class="form-group">
              <label class="form-label">Facebook</label>
              <input type="url" class="form-input" id="facebook" placeholder="https://facebook.com/...">
            </div>
            <div class="form-group">
              <label class="form-label">Instagram</label>
              <input type="url" class="form-input" id="instagram" placeholder="https://instagram.com/...">
            </div>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label class="form-label">YouTube</label>
              <input type="url" class="form-input" id="youtube" placeholder="https://youtube.com/...">
            </div>
            <div class="form-group">
              <label class="form-label">TikTok</label>
              <input type="url" class="form-input" id="tiktok" placeholder="https://tiktok.com/...">
            </div>
          </div>
          <div class="form-group">
            <label class="form-label">Twitter/X</label>
            <input type="url" class="form-input" id="twitter" placeholder="https://x.com/...">
          </div>
        </div>
      </div>

      <!-- Design -->
      <div class="card">
        <div class="card-header">
          <h3 class="card-title">Design</h3>
          <p class="card-desc">Theme-Farben (wirken sich direkt auf das Design aus)</p>
        </div>
        <div class="card-body">
          <div class="form-row">
            <div class="form-group">
              <label class="form-label">Primärfarbe</label>
              <div class="color-picker-group">
                <input type="color" class="color-picker" id="primaryColor" value="#2563EB">
                <input type="text" class="form-input input-width-120" id="primaryColorHex" value="#2563EB">
              </div>
            </div>
            <div class="form-group">
              <label class="form-label">Sekundärfarbe</label>
              <div class="color-picker-group">
                <input type="color" class="color-picker" id="secondaryColor" value="#10B981">
                <input type="text" class="form-input input-width-120" id="secondaryColorHex" value="#10B981">
              </div>
            </div>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label class="form-label">Akzentfarbe</label>
              <div class="color-picker-group">
                <input type="color" class="color-picker" id="accentColor" value="#F59E0B">
                <input type="text" class="form-input input-width-120" id="accentColorHex" value="#F59E0B">
              </div>
            </div>
            <div class="form-group">
              <label class="form-label">Dunkel (Text)</label>
              <div class="color-picker-group">
                <input type="color" class="color-picker" id="darkColor" value="#111827">
                <input type="text" class="form-input input-width-120" id="darkColorHex" value="#111827">
              </div>
            </div>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label class="form-label">Hell (Hintergrund)</label>
              <div class="color-picker-group">
                <input type="color" class="color-picker" id="lightColor" value="#F9FAFB">
                <input type="text" class="form-input input-width-120" id="lightColorHex" value="#F9FAFB">
              </div>
            </div>
            <div class="form-group">
              <label class="form-label">Hinweis</label>
              <p class="form-hint">Logo / Header / Footer bearbeitest du unter <strong>Seiten → Global</strong>.</p>
            </div>
          </div>
        </div>
      </div>

    </div>
  </main>

  <div class="toast-container" id="toastContainer"></div>

  <script>
    const API_URL = new URL('/api', window.location.origin).toString().replace(/\/$/, '');
    let settingsData = {};
    let designData = {};

    function showToast(message, type = 'info') {
      const container = document.getElementById('toastContainer');
      const toast = document.createElement('div');
      toast.className = `toast ${type}`;
      toast.textContent = message;
      container.appendChild(toast);
      setTimeout(() => toast.remove(), 3000);
    }

    function syncColorInputs(colorId, hexId) {
      const color = document.getElementById(colorId);
      const hex = document.getElementById(hexId);
      if (!color || !hex) return;
      color.addEventListener('input', () => {
        hex.value = color.value;
      });
      hex.addEventListener('input', () => {
        color.value = hex.value;
      });
    }

    // Color picker sync
    syncColorInputs('primaryColor', 'primaryColorHex');
    syncColorInputs('secondaryColor', 'secondaryColorHex');
    syncColorInputs('accentColor', 'accentColorHex');
    syncColorInputs('darkColor', 'darkColorHex');
    syncColorInputs('lightColor', 'lightColorHex');

    // Load settings
    async function loadSettings() {
      try {
        const [settingsRes, designRes] = await Promise.all([
          fetch(`${API_URL}/data/settings.json`),
          fetch(`${API_URL}/data/design.json`)
        ]);

        settingsData = settingsRes.ok ? await settingsRes.json() : {};
        designData = designRes.ok ? await designRes.json() : {};

        document.getElementById('siteTitle').value = settingsData.site_title || '';
        document.getElementById('siteDescription').value = settingsData.site_description || '';

        const c = settingsData.contact || {};
        document.getElementById('contactEmail').value = c.email || '';
        document.getElementById('contactPhone').value = c.phone || '';
        document.getElementById('contactAddress').value = c.address || '';
        document.getElementById('contactCity').value = c.city || '';
        document.getElementById('contactCountry').value = c.country || '';
        document.getElementById('contactMapsUrl').value = c.maps_url || '';

        const sm = settingsData.social_media || {};
        document.getElementById('instagram').value = sm.instagram || '';
        document.getElementById('facebook').value = sm.facebook || '';
        document.getElementById('youtube').value = sm.youtube || '';
        document.getElementById('tiktok').value = sm.tiktok || '';
        document.getElementById('twitter').value = sm.twitter || '';

        const theme = designData.theme || {};
        const setColor = (id, value) => {
          const el = document.getElementById(id);
          if (el) el.value = value;
        };

        setColor('primaryColor', theme.primary_color || '#2563EB');
        setColor('primaryColorHex', document.getElementById('primaryColor').value);

        setColor('secondaryColor', theme.secondary_color || '#10B981');
        setColor('secondaryColorHex', document.getElementById('secondaryColor').value);

        setColor('accentColor', theme.accent_color || '#F59E0B');
        setColor('accentColorHex', document.getElementById('accentColor').value);

        setColor('darkColor', theme.dark_color || '#111827');
        setColor('darkColorHex', document.getElementById('darkColor').value);

        setColor('lightColor', theme.light_color || '#F9FAFB');
        setColor('lightColorHex', document.getElementById('lightColor').value);
      } catch (err) {
        console.log('Could not load settings:', err);
      }
    }

    // Save settings
    async function saveSettings() {
      try {
        settingsData.site_title = document.getElementById('siteTitle').value.trim();
        settingsData.site_description = document.getElementById('siteDescription').value.trim();

        settingsData.contact = settingsData.contact || {};
        settingsData.contact.email = document.getElementById('contactEmail').value.trim();
        settingsData.contact.phone = document.getElementById('contactPhone').value.trim();
        settingsData.contact.address = document.getElementById('contactAddress').value.trim();
        settingsData.contact.city = document.getElementById('contactCity').value.trim();
        settingsData.contact.country = document.getElementById('contactCountry').value.trim();
        settingsData.contact.maps_url = document.getElementById('contactMapsUrl').value.trim();

        settingsData.social_media = settingsData.social_media || {};
        settingsData.social_media.instagram = document.getElementById('instagram').value.trim();
        settingsData.social_media.facebook = document.getElementById('facebook').value.trim();
        settingsData.social_media.youtube = document.getElementById('youtube').value.trim();
        settingsData.social_media.tiktok = document.getElementById('tiktok').value.trim();
        settingsData.social_media.twitter = document.getElementById('twitter').value.trim();

        designData.theme = designData.theme || {};
        designData.theme.primary_color = document.getElementById('primaryColor').value;
        designData.theme.secondary_color = document.getElementById('secondaryColor').value;
        designData.theme.accent_color = document.getElementById('accentColor').value;
        designData.theme.dark_color = document.getElementById('darkColor').value;
        designData.theme.light_color = document.getElementById('lightColor').value;

        const [settingsSaveRes, designSaveRes] = await Promise.all([
          fetch(`${API_URL}/data/settings.json`, {
            method: 'PUT',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(settingsData)
          }),
          fetch(`${API_URL}/data/design.json`, {
            method: 'PUT',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(designData)
          })
        ]);

        if (!settingsSaveRes.ok || !designSaveRes.ok) {
          throw new Error('Speichern fehlgeschlagen');
        }

        // Trigger build
        await fetch(`${API_URL}/build`, { method: 'POST' });

        showToast('Einstellungen gespeichert!', 'success');
      } catch (err) {
        showToast('Fehler: ' + err.message, 'error');
      }
    }

    loadSettings();
  </script>
</body>
</html>
